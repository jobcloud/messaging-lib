<?xml version="1.0" encoding="UTF-8"?>
<project>
    <property name="php-version" value="7.1" />
    <target name="disable-xdebug-cli" description="Disable Xdebug for cli">
        <disable-php-mod php-module="xdebug" php-service="cli"/>
    </target>

    <target name="enable-xdebug-cli" description="Enable Xdebug for cli">
        <enable-php-mod php-module="xdebug" php-service="cli"/>
    </target>

    <target name="disable-xdebug-fpm" description="Disables Xdebug for FPM">
        <disable-php-mod php-module="xdebug" php-service="fpm"/>
        <antcall target="php-fpm-reload"/>
    </target>

    <target name="enable-xdebug-fpm" description="Enables Xdebug for FPM">
        <enable-php-mod php-module="xdebug" php-service="fpm"/>
        <antcall target="php-fpm-reload"/>
    </target>

    <target name="disable-blackfire-fpm" description="Disables blackfire for FPM">
        <disable-php-mod php-module="blackfire" php-service="fpm"/>
        <antcall target="php-fpm-reload"/>
    </target>

    <target name="enable-blackfire-fpm" description="Enables blackfire for FPM">
        <enable-php-mod php-module="blackfire" php-service="fpm"/>
        <antcall target="php-fpm-reload"/>
    </target>

    <target name="php-fpm-reload" description="Reloads php fpm">
        <exec executable="sudo">
            <arg value="service" />
            <arg value="php${php-version}-fpm" />
            <arg value="reload" />
        </exec>
        <echo>php-fpm reload successful</echo>
    </target>

    <macrodef name="disable-php-mod" description="Disable a php module">
        <attribute name="php-service"/>
        <attribute name="php-module"/>
        <sequential>
            <change-php-mod modexec="phpdismod" php-service="@{php-service}" php-module="@{php-module}"/>
        </sequential>
    </macrodef>

    <macrodef name="enable-php-mod" description="Enable a php module">
        <attribute name="php-service"/>
        <attribute name="php-module"/>
        <sequential>
            <change-php-mod modexec="phpenmod" php-service="@{php-service}" php-module="@{php-module}"/>
        </sequential>
    </macrodef>

    <macrodef name="change-php-mod" description="Enable / disable a php module">
        <attribute name="php-service"/>
        <attribute name="php-module"/>
        <attribute name="modexec"/>
        <sequential>
            <exec executable="sudo">
                <arg value="-S" />
                <arg value="@{modexec}" />
                <arg value="-v" />
                <arg value="${php-version}" />
                <arg value="-s" />
                <arg value="@{php-service}" />
                <arg value="@{php-module}" />
            </exec>
            <echo message="@{modexec} @{php-module} for @{php-service} was successful"/>
        </sequential>
    </macrodef>
</project>